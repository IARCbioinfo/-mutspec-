<?xml version="1.0"?>
<tool id="mutSpecnmf" name="MutSpec NMF" version="0.0.1">
<description>Extract mutation signatures with the Non negative Matrix Factorization algorithm</description>

<requirements>
    <requirement type="set_environment">SCRIPT_PATH</requirement>
    <requirement type="package" version="5.18.1">perl</requirement>
    <requirement type="package" version="3.1.2">R</requirement>
    <requirement type="package" version="1.7.1">numpy</requirement>
    <requirement type="package" version="0.1">mutspec</requirement>
</requirements>

<command interpreter="bash">
	mutspecNmf_wrapper.sh
	$html_file
	"--nbSign $nbsign"
	${refGenomeSource.source}
	#if $refGenomeSource.source == "html":
		${refGenomeSource.reportHTML}
	#else
		${refGenomeSource.matrix}
	#end if
</command>

<inputs>
	<conditional name="refGenomeSource">
		<param name="source" type="select" label="Input a MutSpec Stats report or a matrix" help="You may select either a report generated by MutSpec-Stats or a tab-delimited text matrix">
			<option value="html">Dataset generated by the tool MutSpec-Stats</option>
			<option value="tab">Tab-delimited matrix</option>
		</param>
		<when value="html">
			<param name="reportHTML" type="data" format="html" label="Input dataset" help="Select a report generated by the MutSpec-Stats tool"/>
		</when>
		<when value="tab">
			<param name="matrix" type="data" format="tabular" label="Input matrix" help="Select a matrix formatted as shown further below"/>
		</when>
	</conditional> 
	<param name="nbsign" type="text" value="2" label="Number of expected signatures" help="min=2" />
</inputs>

<outputs>
	<data name="html_file" format="html" label="NMF result on ${on_string} ($nbsign signatures)" />
</outputs> 

<help>

**What it does**

Extract mutation signatures composed of 96 SBS types (6 SBS types in their trinucleotide sequence context) using the non-negative matrix (`NMF`__) factorisation algorithm of Brunet with the Kullback-Leibler divergence penalty implemented in a `R package`__.

.. __: http://www.nature.com/nature/journal/v401/n6755/full/401788a0.html
.. __: http://www.biomedcentral.com/1471-2105/11/367


--------------------------------------------------------------------------------------------------------------------------------------------------

**Input formats**

The tool accepts a HTML report produces by the tool MutSpec-Stats or a matrix of mutation count in a tab-delimited text file format (see example below).

.. class:: warningmark

If the input is a matrix of mutation count, the sum of mutation counts for each row should be not null.

--------------------------------------------------------------------------------------------------------------------------------------------------

**Output**

Matrices and graphs representing the composition of the mutation signatures found by NMF (Matrix W) and the contributions of each sample to the signatures (Matrix H). The tool also produces a matrice that can be used with the tool MutSpec-compare for comparing the identified signatures with known signatures.

--------------------------------------------------------------------------------------------------------------------------------------------------

**Example: matrix of mutation count (96 rows + a header with the samples names)**

+--------+----------+----------+----------+
|        | Sample_1 | Sample_2 | Sample_3 |
+========+==========+==========+==========+
|A[C>A]A |     4    |     3    |     1    |
+--------+----------+----------+----------+
|A[C>T]A |     2    |     1    |     0    |
+--------+----------+----------+----------+
|A[C>G]A |    13    |     2    |     1    |
+--------+----------+----------+----------+
|A[T>A]A |    10    |     3    |     6    |
+--------+----------+----------+----------+
|A[T>C]A |     9    |     6    |     1    |
+--------+----------+----------+----------+
|A[T>G]A |     2    |     1    |     0    |
+--------+----------+----------+----------+
|                  ...                    |
+--------+----------+----------+----------+
|T[C>A]T |     5    |     2    |     2    |
+--------+----------+----------+----------+
|T[C>G]T |     5    |     2    |     0    |
+--------+----------+----------+----------+
|T[C>T]T |    11    |     4    |     2    |
+--------+----------+----------+----------+
|T[T>A]T |     3    |     0    |     5    |
+--------+----------+----------+----------+
|T[T>C]T |    39    |    17    |     1    |
+--------+----------+----------+----------+
|T[T>G]T |    12    |     8    |     1    |
+--------+----------+----------+----------+


</help>

</tool>
